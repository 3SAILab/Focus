# 图片上传拖拽排序功能

## 1. 功能概述

在创作空间的图片上传区域，允许用户通过拖拽来调整已上传图片的顺序。这对于需要特定图片顺序的场景（如蒙版图片必须在特定位置）非常重要。

## 2. 用户故事

### 2.1 基础拖拽排序
**作为** 用户  
**我想要** 能够拖拽已上传的图片来调整它们的顺序  
**以便** 控制图片在 AI 生成时的输入顺序

**验收标准：**
- 当鼠标悬停在图片上传区域时，所有图片展开显示
- 用户可以点击并拖拽任意图片
- 拖拽时，图片会跟随鼠标移动
- 拖拽过程中，其他图片会实时调整位置，显示插入预览
- 松开鼠标后，图片顺序更新
- 拖拽操作流畅，有适当的视觉反馈

### 2.2 蒙版图片特殊处理
**作为** 使用蒙版功能的用户  
**我想要** 系统能够识别并正确处理蒙版图片  
**以便** 确保蒙版图片在正确的位置

**验收标准：**
- 系统能够识别蒙版图片（通常是黑白图片或特定命名）
- 蒙版图片在视觉上有特殊标识（如边框颜色、图标）
- 拖拽时，蒙版图片的特殊属性保持不变
- 如果有蒙版图片位置要求，系统应给出提示

### 2.3 视觉反馈
**作为** 用户  
**我想要** 在拖拽过程中看到清晰的视觉反馈  
**以便** 知道图片会被放置在哪里

**验收标准：**
- 被拖拽的图片有明显的视觉变化（如阴影、透明度）
- 目标位置有清晰的插入指示器
- 拖拽过程中，其他图片平滑移动到新位置
- 拖拽结束后，有完成动画

## 3. 技术要求

### 3.1 拖拽实现
- 使用原生 HTML5 Drag and Drop API 或 React DnD 库
- 支持触摸设备（移动端）
- 拖拽操作不应影响现有的删除、预览功能

### 3.2 性能要求
- 拖拽操作应流畅，无明显卡顿
- 动画使用 CSS transform 以获得最佳性能
- 避免不必要的重渲染

### 3.3 兼容性
- 保持与现有图片上传功能的兼容
- 不影响其他页面的图片上传组件
- 支持多图片上传后的排序

## 4. 边界情况

### 4.1 单张图片
- 只有一张图片时，不显示拖拽功能
- 添加第二张图片后，自动启用拖拽

### 4.2 最大图片数量
- 遵守现有的图片数量限制
- 拖拽不应改变图片总数

### 4.3 错误处理
- 拖拽失败时，图片返回原位置
- 拖拽到无效区域时，显示提示并取消操作

## 5. UI/UX 设计

### 5.1 拖拽状态
- **正常状态**: 图片堆叠显示，鼠标悬停展开
- **拖拽开始**: 被拖拽图片放大、增加阴影、降低透明度
- **拖拽中**: 其他图片显示插入位置的间隙
- **拖拽结束**: 所有图片平滑移动到最终位置

### 5.2 视觉标识
- 蒙版图片：蓝色边框 + 蒙版图标
- 普通图片：白色边框
- 拖拽中的图片：红色边框 + 放大效果

### 5.3 交互提示
- 首次使用时，显示提示："拖拽图片可调整顺序"
- 鼠标悬停在图片上时，显示拖拽手势光标

## 6. 实现优先级

### P0 (必须实现)
- 基础拖拽排序功能
- 视觉反馈（拖拽状态、插入位置）
- 与现有功能的兼容

### P1 (重要)
- 蒙版图片识别和标识
- 拖拽动画优化
- 触摸设备支持

### P2 (可选)
- 首次使用提示
- 高级蒙版位置验证
- 拖拽历史记录（撤销/重做）

## 7. 测试要点

### 7.1 功能测试
- [ ] 可以拖拽图片改变顺序
- [ ] 拖拽后图片顺序正确保存
- [ ] 删除图片后顺序保持正确
- [ ] 添加新图片后可以排序

### 7.2 视觉测试
- [ ] 拖拽动画流畅
- [ ] 插入位置指示清晰
- [ ] 蒙版图片标识明显

### 7.3 兼容性测试
- [ ] Chrome/Edge 浏览器正常
- [ ] 触摸设备可用
- [ ] 不影响其他页面

### 7.4 边界测试
- [ ] 单张图片时行为正确
- [ ] 拖拽到边界外的处理
- [ ] 快速连续拖拽的处理
